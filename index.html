<html>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<head>
<style>
* {
 margin: 0;
 padding: 0;
 text-decoration: none;
 -webkit-touch-callout:none;
 -webkit-user-select:none;
 -webkit-text-size-adjust:none;
 -webkit-tap-highlight-color: transparent;
}

pre {
  font-family: monospace;
  font-size: 14px;
  margin: 3.5em;
  padding: 1em;
  border: 1px solid black;
}

textarea {
  font-family: monospace;
  font-size: 14px;
  font-weight: bold;
  margin-left: 3.5em;
  margin-bottom: 3.5em;
  padding: 0.5em;
  border-radius: 0;
  color: #00FF00; background: #000000;
  -webkit-user-select: text;
}

.output {
  margin: 1em; padding : 1em;
  font: 20px "American Typewriter";
  border-radius: 0.5em;
  color: #00FF00; background: #000000;
}

#license {
  margin: 0;
  padding: 1em;
  font-family: Helvetica;
  border-bottom: 2px solid #123;
}
</style>
<title>ontouchstart</title>
</head>
<body>
<div id="license">
<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">ontouchstart</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://github.com/ontouchstart/ontouchstart.github.com" property="cc:attributionName" rel="cc:attributionURL">Sam Liu</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.
</div>
<a href="indexCS.html"><button style="margin:5px">CoffeeScript</button></a>
<script type="text/coffeescript">
print = (message) ->
  $output = document.createElement 'div'
  $output.className = 'output'
  $output.innerHTML = message
  document.body.appendChild $output
  return $output

print "Hello, world"

setCanvas = (w = 640, h = 640) ->
  c = document.createElement 'canvas'
  c.width = w
  c.height = h
  c.style.width = w + 'px'
  c.style.height = h + 'px'
  c.style.margin = '1em'
  c.style.marginLeft = (document.body.scrollWidth - w) / 2 + 'px'
  document.body.appendChild c

  ctx = c.getContext '2d'

  ctx.beginPath()
  ctx.moveTo 0,0
  ctx.lineTo w, 0
  ctx.lineTo w, h
  ctx.lineTo 0, h
  ctx.lineTo 0, 0
  ctx.stroke()
  ctx.save()

  ctx.font = "12px American Typewriter";

  ctx.fillText "ontouchstart.github.com", w - 150, h - 10
  document.title = "Touch to draw within the box"

  c.ontouchstart = (e) ->
    if e.touches.length > 1
      document.location = c.toDataURL() 
    else
      ctx.restore()
      ctx.beginPath()
      x = e.touches[0].pageX - c.offsetLeft
      y = e.touches[0].pageY - c.offsetTop
      ctx.moveTo x, y

  c.ontouchmove = (e) ->
    e.preventDefault();
    return if e.touches.length > 1  
    x = e.touches[0].pageX - c.offsetLeft
    y = e.touches[0].pageY - c.offsetTop
    ctx.lineTo x, y
    ctx.stroke()

  c.ontouchend = (e) ->
    document.title = "Rotate to save"
    ctx.save()

  window.onorientationchange = ->
    document.location = c.toDataURL()

  return ctx

ctx = setCanvas(640, 480)
ctx.font = "20px American Typewriter";
ctx.fillText "Hello, world", 10, 30
</script>
<script type="text/javascript" src="coffee-script-1.2.js"></script>
</body>
</html>
