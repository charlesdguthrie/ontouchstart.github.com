<html>
<head>
<meta name="viewport" content="width=768, initial-scale=1" />
<title>ontouchstart.github.com</title>
<style>
pre {
  width: 90%;
  margin: 1em;
  padding: 1em;
  border: 1px solid black;
  -webkit-transition-duration: 1000ms;
}
</style>
</head>
<body>
<pre>      
window.preventTouchmove = () ->
   document.addEventListener 'touchmove',  (e) -> 
     e.preventDefault()
</pre>

<pre>
window.css = (rule) -> 
  document.styleSheets[0].insertRule rule
</pre>

<pre>
window.el = (parent, tag, id, className) ->
  element = document.createElement tag
  if(id) 
    element.id = id
  if(className)
    element.className = className
  parent.appendChild element
  return element
</pre>

<pre>
window.resetCSS = () ->
  css " * { position: absolute}"
  css " * { margin: 0}"
  css " * { padding: 0}"
  css " * { -webkit-touch-callout:none}"
  css " * { -webkit-user-select:none}"
  css " * { -webkit-text-size-adjust:none}"
  css " * { -webkit-tap-highlight-color: transparent}"
</pre>
       
<pre>
window.trigger = (target, name, data) ->
  evt = document.createEvent 'Events'
  evt.initEvent name, true, true
  evt.data = data
  target.dispatchEvent evt
</pre>
       
<pre>
window.touchmoveToSpin = (sensor, listenerArray) ->
  x_min = parseInt sensor.style.left 
  w = parseInt sensor.style.width 
        
  spinCSS = (angle_min, angle_max, n) ->
    angle = angle_min
    d = (angle_max - angle_min) / n
    for i in [0..n-1]
      css ".spin-#{i} { -webkit-transform: rotateY(#{angle}deg);}"
      angle += d
  
  spinCSS -180, 180, w

  spin = (e) ->
    x = e.touches[0].pageX
    x_min = parseInt sensor.style.left
    w = parseInt sensor.style.width 
    if x < x_min
      return
    if x > (x_min + w)
      return
    for i in [0..listenerArray.length-1]
        trigger listenerArray[i], 'spin', "spin-#{x - x_min}"
  sensor.addEventListener 'touchmove', spin
</pre>
       
<pre>
window.container = () ->
  width = 640
  height = 480
  depth = 500
  c = el document.body, 'div'
  c.style.width = width + 'px'
  c.style.height = height + 'px'
  c.style.webkitPerspective = depth + 'px'
  c.style.backgroundColor = '#123'
  c.style.color = '#abc'
  c.style.fontFamily = 'Helvetica'
  c.center = () ->
    c.style.left = (document.body.scrollWidth - width) / 2 + 'px'
    c.style.top = (document.body.scrollHeight - height) / 2 + 'px'

  window.addEventListener 'resize', c.center
  c.center()
  return c
</pre>
       
<pre>
window.spin = () ->    
  page = container()        
  text = el page, 'h1'
  text.style.width = '100%'
  text.style.textAlign = 'center'
  text.style.bottom = '50%'

  text.innerHTML = 'Simple is hard'

  spinClass = el page, 'h4' 
  spinClass.style.width = '100%'
  spinClass.style.textAlign = 'center'
  touchmoveToSpin page, [text, spinClass]

  text.addEventListener 'spin', (e) ->
    text.className = e.data

  spinClass.addEventListener 'spin', (e) ->
    spinClass.innerHTML = e.data

  return page
</pre>

<pre>
preventTouchmove()
resetCSS()
spin()
</pre>

<script type="text/javascript" src="coffee-script.js"></script>
<script>
(function () {
  var codeArray = document.getElementsByTagName('pre');
  function loadCode(i) {
    var code = codeArray[i];
    var js = document.createElement('script');
    js.innerText = CoffeeScript.compile(code.innerText);

    code.style.webkitTransitionDelay = i * 100 + 'ms';
    code.style.padding = '0';
    code.style.width = '0';
    code.style.height = '0';
    
    code.style.overflow = 'hidden';

    code.addEventListener('webkitTransitionEnd', function () {
      code.ontouchstart = null;
      code.style.display = 'none';
      document.body.appendChild(js);
    });
  }
  
  function code(i) {
    return function () {
      for( var j = 0; j <= i; j++) {
        loadCode(j);
      }
    };
  }

  for (var i = 0; i < codeArray.length; i++) {
    codeArray[i].ontouchstart = code(i);
  }
})();
</script>
</body>
</html>